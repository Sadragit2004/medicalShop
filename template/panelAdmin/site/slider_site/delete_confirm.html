{% extends '../../base/base.html' %}

{% block title %}حذف اسلایدر - {{ slider.textSlider }}{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'panelAdmin:admin_slider_site_list' %}">اسلایدرهای سایت</a></li>
<li class="breadcrumb-item active">حذف {{ slider.textSlider|truncatechars:20 }}</li>
{% endblock %}

{% block page_title %}حذف اسلایدر <small class="text-muted">({{ slider.textSlider }})</small>{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card border-danger">
            <div class="card-header bg-danger text-white">
                <h5 class="card-title mb-0"><i class="fas fa-exclamation-triangle"></i> تأیید حذف اسلایدر</h5>
            </div>
            <div class="card-body">
                <!-- هشدار -->
                <div class="alert alert-danger mb-4">
                    <div class="d-flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-exclamation-circle fa-2x"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h5 class="alert-heading">هشدار!</h5>
                            <p class="mb-0">آیا از حذف این اسلایدر اطمینان دارید؟ این عمل غیرقابل بازگشت است.</p>
                        </div>
                    </div>
                </div>

                <!-- اطلاعات اسلایدر -->
                <div class="card mb-4">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">مشخصات اسلایدر</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 text-center mb-3">
                                {% if slider.imageName %}
                                <img src="{{ slider.imageName.url }}" alt="{{ slider.altSlide }}"
                                     class="img-fluid rounded mb-3" style="max-height: 150px; object-fit: contain;">
                                {% else %}
                                <div class="no-image-medium">
                                    <i class="fas fa-image fa-3x text-muted"></i>
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-md-8">
                                <h4>{{ slider.textSlider }}</h4>
                                {% if slider.altSlide %}
                                <p class="text-muted">{{ slider.altSlide }}</p>
                                {% endif %}

                                <div class="row mt-3">
                                    <div class="col-md-6 mb-2">
                                        <strong>تاریخ شروع:</strong><br>
                                        <span class="text-muted">{{ slider.registerData|date:"Y/m/d H:i" }}</span>
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <strong>تاریخ پایان:</strong><br>
                                        <span class="text-muted">{{ slider.endData|date:"Y/m/d H:i" }}</span>
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <strong>وضعیت:</strong><br>
                                        {% if slider.isActive %}
                                        <span class="badge bg-success">فعال</span>
                                        {% else %}
                                        <span class="badge bg-danger">غیرفعال</span>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <strong>تاریخ ایجاد:</strong><br>
                                        <span class="text-muted">{{ slider.createdAt|date:"Y/m/d" }}</span>
                                    </div>
                                </div>

                                {% if slider.link %}
                                <div class="mt-3">
                                    <strong>لینک:</strong><br>
                                    <a href="{{ slider.link }}" target="_blank" class="text-break">
                                        {{ slider.link|truncatechars:50 }}
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- وضعیت زمان -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h6 class="mb-0"><i class="fas fa-clock"></i> وضعیت زمانی</h6>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-4 mb-3">
                                <div class="p-3 {% if slider.is_upcoming %}bg-warning{% else %}bg-light{% endif %} rounded">
                                    <div class="h4 mb-0">{% if slider.is_upcoming %}<i class="fas fa-hourglass-start"></i>{% else %}<i class="fas fa-check"></i>{% endif %}</div>
                                    <div>شروع نشده</div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="p-3 {% if not slider.is_upcoming and not slider.is_expired %}bg-success text-white{% else %}bg-light{% endif %} rounded">
                                    <div class="h4 mb-0">{% if not slider.is_upcoming and not slider.is_expired %}<i class="fas fa-play"></i>{% else %}<i class="fas fa-pause"></i>{% endif %}</div>
                                    <div>در حال اجرا</div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="p-3 {% if slider.is_expired %}bg-danger text-white{% else %}bg-light{% endif %} rounded">
                                    <div class="h4 mb-0">{% if slider.is_expired %}<i class="fas fa-times"></i>{% else %}<i class="fas fa-hourglass-end"></i>{% endif %}</div>
                                    <div>منقضی شده</div>
                                </div>
                            </div>
                        </div>

                        <div class="progress mt-3" style="height: 20px;">
                            {% if slider.is_upcoming %}
                            <div class="progress-bar bg-warning" style="width: 20%">قبل از شروع</div>
                            {% elif slider.is_expired %}
                            <div class="progress-bar bg-danger" style="width: 100%">منقضی شده</div>
                            {% else %}
                            <div class="progress-bar bg-success" style="width: 60%">در حال اجرا</div>
                            <div class="progress-bar bg-light" style="width: 40%">باقی‌مانده</div>
                            {% endif %}
                        </div>

                        <div class="mt-3">
                            <p class="mb-0">
                                {% if slider.is_upcoming %}
                                <i class="fas fa-info-circle text-warning"></i>
                                این اسلایدر هنوز شروع نشده است.
                                {% elif slider.is_expired %}
                                <i class="fas fa-info-circle text-danger"></i>
                                این اسلایدر منقضی شده است.
                                {% else %}
                                <i class="fas fa-info-circle text-success"></i>
                                این اسلایدر در حال حاضر در سایت نمایش داده می‌شود.
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>

                <!-- فرم حذف -->
                <form method="post" id="deleteForm">
                    {% csrf_token %}
                    <div class="d-flex justify-content-between">
                        <a href="{% url 'panelAdmin:admin_slider_site_list' %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-right"></i> بازگشت
                        </a>
                        <button type="submit" class="btn btn-danger">
                            <i class="fas fa-trash"></i> بله، حذف شود
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
.card.border-danger {
    border-width: 2px;
    border-color: #dc3545 !important;
}

.no-image-medium {
    width: 150px;
    height: 150px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f8f9fa;
    border-radius: 8px;
    margin: 0 auto;
    border: 2px dashed #dee2e6;
}

.progress-bar {
    border-radius: 0;
}

.progress-bar:first-child {
    border-top-right-radius: 4px;
    border-bottom-right-radius: 4px;
}

.progress-bar:last-child {
    border-top-left-radius: 4px;
    border-bottom-left-radius: 4px;
}
</style>

<script>
// تأیید نهایی حذف
document.getElementById('deleteForm').addEventListener('submit', function(e) {
    let message = '⚠️ هشدار نهایی!\n\n';
    message += 'با حذف این اسلایدر:\n';
    message += '• این اسلایدر از سایت حذف خواهد شد\n';
    message += '• تصویر آن از سرور حذف می‌شود\n';
    message += '• این عمل غیرقابل بازگشت است\n\n';

    {% if not slider.is_expired and slider.isActive %}
    message += '⚠️ توجه: این اسلایدر فعال است و در سایت نمایش داده می‌شود.\n\n';
    {% endif %}

    message += 'آیا مطمئن هستید؟';

    if (!confirm(message)) {
        e.preventDefault();
    }
});

// شمارش معکوس برای تایید
let countdown = 3;
const submitBtn = document.querySelector('#deleteForm button[type="submit"]');
const originalText = submitBtn.innerHTML;

function updateButton() {
    if (countdown > 0) {
        submitBtn.innerHTML = `(${countdown}) ${originalText}`;
        submitBtn.disabled = true;
        countdown--;
        setTimeout(updateButton, 1000);
    } else {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }
}

// فعال‌سازی شمارش معکوس
updateButton();
</script>
{% endblock %}