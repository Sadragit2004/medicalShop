<!-- templates/admin/products/sale_type/create.html -->
{% extends '../../base/base.html' %}

{% block title %}Ø§ÙØ²ÙˆØ¯Ù† Ù†ÙˆØ¹ ÙØ±ÙˆØ´{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'panelAdmin:admin_dashboard' %}">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a></li>
<li class="breadcrumb-item"><a href="{% url 'panelAdmin:admin_product_list' %}">Ù…Ø­ØµÙˆÙ„Ø§Øª</a></li>
<li class="breadcrumb-item"><a href="{% url 'panelAdmin:admin_product_detail' product.id %}">{{ product.title|truncatechars:20 }}</a></li>
<li class="breadcrumb-item active">Ø§ÙØ²ÙˆØ¯Ù† Ù†ÙˆØ¹ ÙØ±ÙˆØ´</li>
{% endblock %}

{% block page_title %}
<div class="d-flex justify-content-between align-items-center">
    <h4>Ø§ÙØ²ÙˆØ¯Ù† Ù†ÙˆØ¹ ÙØ±ÙˆØ´ Ø¬Ø¯ÛŒØ¯</h4>
    <div class="badge bg-info">
        <i class="fas fa-box"></i> {{ product.title|truncatechars:30 }}
    </div>
</div>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="card-title mb-0"><i class="fas fa-tags"></i> ÙØ±Ù… Ø§ÛŒØ¬Ø§Ø¯ Ù†ÙˆØ¹ ÙØ±ÙˆØ´</h5>
            </div>
            <div class="card-body">
                <form method="post" id="saleTypeForm" novalidate>
                    {% csrf_token %}

                    <!-- Ù†ÙˆØ¹ ÙØ±ÙˆØ´ -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="border-bottom pb-2 mb-3">ğŸ·ï¸ Ø§Ù†ØªØ®Ø§Ø¨ Ù†ÙˆØ¹ ÙØ±ÙˆØ´</h6>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="typeSale" class="form-label required">Ù†ÙˆØ¹ ÙØ±ÙˆØ´</label>
                            <select class="form-select" id="typeSale" name="typeSale" required>
                                <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
                                {% for value, label in sale_types %}
                                <option value="{{ value }}">{{ label }}</option>
                                {% endfor %}
                            </select>
                            <div class="form-text">Ù†Ø­ÙˆÙ‡ ÙØ±ÙˆØ´ Ù…Ø­ØµÙˆÙ„ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="title" class="form-label">Ø¹Ù†ÙˆØ§Ù† Ù†Ù…Ø§ÛŒØ´ÛŒ</label>
                            <input type="text"
                                   class="form-control"
                                   id="title"
                                   name="title"
                                   placeholder="Ù…Ø«Ø§Ù„: ÙØ±ÙˆØ´ Ø¹Ù…Ø¯Ù‡ØŒ ÙØ±ÙˆØ´ ØªÚ©â€ŒÙ†ÙØ±Ù‡">
                            <div class="form-text">Ø¹Ù†ÙˆØ§Ù†ÛŒ Ú©Ù‡ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯</div>
                        </div>
                    </div>

                    <!-- Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="border-bottom pb-2 mb-3">ğŸ’° Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ</h6>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="price" class="form-label required">Ù‚ÛŒÙ…Øª (ØªÙˆÙ…Ø§Ù†)</label>
                            <div class="input-group">
                                <input type="number"
                                       class="form-control"
                                       id="price"
                                       name="price"
                                       required
                                       min="0"
                                       step="1000"
                                       placeholder="0"
                                       oninput="formatPrice(this)">
                                <span class="input-group-text">ØªÙˆÙ…Ø§Ù†</span>
                            </div>
                            <div class="form-text">Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÙ‡ Ù…Ø­ØµÙˆÙ„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</div>
                            <div id="pricePreview" class="mt-2 text-success fw-bold"></div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="finalPrice" class="form-label">Ù‚ÛŒÙ…Øª Ù†Ù‡Ø§ÛŒÛŒ (ØªÙˆÙ…Ø§Ù†)</label>
                            <div class="input-group">
                                <input type="number"
                                       class="form-control"
                                       id="finalPrice"
                                       name="finalPrice"
                                       readonly
                                       placeholder="Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯">
                                <span class="input-group-text">ØªÙˆÙ…Ø§Ù†</span>
                            </div>
                            <div class="form-text">Ù‚ÛŒÙ…Øª Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø¹Ø¯ Ø§Ø² Ù…Ø­Ø§Ø³Ø¨Ø§Øª</div>
                        </div>
                    </div>

                    <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡ -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="border-bottom pb-2 mb-3">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡</h6>
                        </div>

                        <!-- ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø± Ú©Ø§Ø±ØªÙ† -->
                        <div class="col-md-4 mb-3 carton-setting d-none">
                            <label for="memberCarton" class="form-label required">ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø± Ú©Ø§Ø±ØªÙ†</label>
                            <div class="input-group">
                                <input type="number"
                                       class="form-control"
                                       id="memberCarton"
                                       name="memberCarton"
                                       min="1"
                                       placeholder="12">
                                <span class="input-group-text">Ø¹Ø¯Ø¯</span>
                            </div>
                            <div class="form-text">ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„ Ø¯Ø± Ù‡Ø± Ú©Ø§Ø±ØªÙ†</div>
                        </div>

                        <!-- Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø®Ø±ÛŒØ¯ -->
                        <div class="col-md-4 mb-3 limited-setting d-none">
                            <label for="limitedSale" class="form-label required">Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø®Ø±ÛŒØ¯</label>
                            <div class="input-group">
                                <input type="number"
                                       class="form-control"
                                       id="limitedSale"
                                       name="limitedSale"
                                       min="1"
                                       placeholder="5">
                                <span class="input-group-text">Ø¹Ø¯Ø¯</span>
                            </div>
                            <div class="form-text">Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¨Ù„ Ø®Ø±ÛŒØ¯</div>
                        </div>

                        <!-- ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ -->
                        <div class="col-md-4 mb-3">
                            <div class="form-check form-switch mt-4 pt-2">
                                <input class="form-check-input"
                                       type="checkbox"
                                       id="isActive"
                                       name="isActive"
                                       checked>
                                <label class="form-check-label fw-bold" for="isActive">
                                    <i class="fas fa-toggle-on text-success"></i> ÙØ¹Ø§Ù„
                                </label>
                                <div class="form-text">Ø§ÛŒÙ† Ù†ÙˆØ¹ ÙØ±ÙˆØ´ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨Ø§Ø´Ø¯</div>
                            </div>
                        </div>
                    </div>

                    <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø­ØµÙˆÙ„ -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="card bg-light">
                                <div class="card-body">
                                    <h6 class="mb-3"><i class="fas fa-info-circle"></i> Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø­ØµÙˆÙ„</h6>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="mb-2">
                                                <small class="text-muted">Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ØµÙˆÙ„:</small>
                                                <div class="fw-bold">{{ product.title }}</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-2">
                                                <small class="text-muted">ÙˆØ¶Ø¹ÛŒØª:</small>
                                                <div>
                                                    {% if product.isActive %}
                                                    <span class="badge bg-success">ÙØ¹Ø§Ù„</span>
                                                    {% else %}
                                                    <span class="badge bg-danger">ØºÛŒØ±ÙØ¹Ø§Ù„</span>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-2">
                                                <small class="text-muted">ØªØ¹Ø¯Ø§Ø¯ Ø§Ù†ÙˆØ§Ø¹ ÙØ±ÙˆØ´:</small>
                                                <div class="fw-bold">{{ product.saleTypes.count }}</div>
                                            </div>
                                        </div>
                                    </div>
                                    {% if product.saleTypes.count > 0 %}
                                    <div class="alert alert-warning mt-3">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        Ø§ÛŒÙ† Ù…Ø­ØµÙˆÙ„ {{ product.saleTypes.count }} Ù†ÙˆØ¹ ÙØ±ÙˆØ´ Ø¯ÛŒÚ¯Ø± Ø¯Ø§Ø±Ø¯.
                                        Ø­ÙˆØ§Ø³ØªÙˆÙ† Ø¨Ø§Ø´Ù‡ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ ØªØ¯Ø§Ø®Ù„ Ù†Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù‡.
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ù‚Ø¯Ø§Ù… -->
                    <div class="row">
                        <div class="col-12">
                            <div class="d-flex justify-content-between">
                                <a href="{% url 'panelAdmin:admin_product_detail' product.id %}"
                                   class="btn btn-secondary">
                                    <i class="fas fa-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ø­ØµÙˆÙ„
                                </a>
                                <div>
                                    <button type="reset" class="btn btn-outline-secondary me-2">
                                        <i class="fas fa-redo"></i> Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ
                                    </button>
                                    <button type="submit" class="btn btn-success">
                                        <i class="fas fa-save"></i> Ø§ÛŒØ¬Ø§Ø¯ Ù†ÙˆØ¹ ÙØ±ÙˆØ´
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Ù¾Ù†Ù„ Ø±Ø§Ù‡Ù†Ù…Ø§ -->
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="card-title mb-0"><i class="fas fa-question-circle"></i> Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ù†ÙˆØ§Ø¹ ÙØ±ÙˆØ´</h5>
            </div>
            <div class="card-body">
                <!-- ØªÚ© ÙØ±ÙˆØ´ÛŒ -->
                <div class="guide-item mb-4">
                    <h6 class="text-primary"><i class="fas fa-shopping-cart"></i> ØªÚ© ÙØ±ÙˆØ´ÛŒ</h6>
                    <p class="small text-muted">ÙØ±ÙˆØ´ Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ ØµÙˆØ±Øª ØªÚ©ÛŒ. Ù‡Ø± Ø¹Ø¯Ø¯ Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ù…Ø´Ø®Øµ Ø´Ø¯Ù‡ Ø¨Ù‡ ÙØ±ÙˆØ´ Ù…ÛŒâ€ŒØ±Ø³Ø¯.</p>
                    <ul class="small">
                        <li>Ù‚ÛŒÙ…Øª = Ù‚ÛŒÙ…Øª Ù‡Ø± Ø¹Ø¯Ø¯</li>
                        <li>Ø¨Ø¯ÙˆÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª ØªØ¹Ø¯Ø§Ø¯</li>
                        <li>Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ Ù…Ø´ØªØ±ÛŒØ§Ù† Ø¹Ø§Ø¯ÛŒ</li>
                    </ul>
                </div>

                <!-- Ú©Ø§Ø±ØªÙ† ÙØ±ÙˆØ´ÛŒ -->
                <div class="guide-item mb-4">
                    <h6 class="text-success"><i class="fas fa-boxes"></i> Ú©Ø§Ø±ØªÙ† ÙØ±ÙˆØ´ÛŒ</h6>
                    <p class="small text-muted">ÙØ±ÙˆØ´ Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ ØµÙˆØ±Øª Ú©Ø§Ø±ØªÙ†ÛŒ. Ù‚ÛŒÙ…Øª Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ú©Ø§Ø±ØªÙ† Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
                    <ul class="small">
                        <li>Ù‚ÛŒÙ…Øª = Ù‚ÛŒÙ…Øª Ù‡Ø± Ú©Ø§Ø±ØªÙ†</li>
                        <li>ØªØ¹ÛŒÛŒÙ† ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø± Ù‡Ø± Ú©Ø§Ø±ØªÙ†</li>
                        <li>Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´ Ø¹Ù…Ø¯Ù‡</li>
                    </ul>
                </div>

                <!-- ØªÚ© ÙØ±ÙˆØ´ÛŒ Ø¨Ø§ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª -->
                <div class="guide-item">
                    <h6 class="text-warning"><i class="fas fa-exclamation-triangle"></i> ØªÚ© ÙØ±ÙˆØ´ÛŒ Ø¨Ø§ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª</h6>
                    <p class="small text-muted">ÙØ±ÙˆØ´ ØªÚ©ÛŒ Ø¨Ø§ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª ØªØ¹Ø¯Ø§Ø¯ Ø®Ø±ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ú©Ø§Ø±Ø¨Ø±.</p>
                    <ul class="small">
                        <li>Ù‚ÛŒÙ…Øª = Ù‚ÛŒÙ…Øª Ù‡Ø± Ø¹Ø¯Ø¯</li>
                        <li>ØªØ¹ÛŒÛŒÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø®Ø±ÛŒØ¯</li>
                        <li>Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ Ø­Ø±Ø§Ø¬ÛŒâ€ŒÙ‡Ø§</li>
                    </ul>
                </div>

                <hr>

                <!-- Ù†Ú©Ø§Øª Ù…Ù‡Ù… -->
                <div class="alert alert-warning">
                    <h6><i class="fas fa-lightbulb"></i> Ù†Ú©Ø§Øª Ù…Ù‡Ù…</h6>
                    <ul class="small mb-0">
                        <li>Ù‚ÛŒÙ…Øª Ù†Ù‡Ø§ÛŒÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø¨Ø±Ø§Ø¨Ø± Ø¨Ø§ Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÙ‡ Ø§Ø³Øª</li>
                        <li>Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±ØªÙ† ÙØ±ÙˆØ´ÛŒØŒ Ù‚ÛŒÙ…Øª Ù‡Ø± Ú©Ø§Ø±ØªÙ† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</li>
                        <li>Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø®Ø±ÛŒØ¯ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù†ÙˆØ¹ Ø³ÙˆÙ… Ú©Ø§Ø±Ø¨Ø±Ø¯ Ø¯Ø§Ø±Ø¯</li>
                        <li>Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ú†Ù†Ø¯ Ù†ÙˆØ¹ ÙØ±ÙˆØ´ Ø¨Ø±Ø§ÛŒ ÛŒÚ© Ù…Ø­ØµÙˆÙ„ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ -->
        <div class="card mt-3">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0"><i class="fas fa-eye"></i> Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´</h5>
            </div>
            <div class="card-body">
                <div id="previewContent" class="text-center text-muted">
                    <i class="fas fa-shopping-cart fa-3x mb-3"></i>
                    <p>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ ØªØ§ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯</p>
                </div>

                <div id="pricePreviewCard" class="d-none">
                    <div class="text-center">
                        <div class="display-4 text-success mb-2" id="previewPrice">0</div>
                        <div class="text-muted" id="previewType">ØªÙˆÙ…Ø§Ù†</div>
                        <hr>
                        <div class="small">
                            <div id="previewDetails"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.required:after {
    content: " *";
    color: red;
}

.guide-item {
    padding: 15px;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    background: #f8f9fa;
}

.guide-item h6 i {
    margin-left: 8px;
}

.input-group-text {
    background-color: #f8f9fa;
    color: #495057;
}

#pricePreviewCard {
    animation: fadeIn 0.5s;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}
</style>

<script>
// Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ù…Ø§ÛŒØ´ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ ÙØ±ÙˆØ´
document.getElementById('typeSale').addEventListener('change', function() {
    updateFormFields();
    updatePreview();
});

document.getElementById('price').addEventListener('input', function() {
    formatPrice(this);
    updatePreview();
    updateFinalPrice();
});

document.getElementById('memberCarton').addEventListener('input', updatePreview);
document.getElementById('limitedSale').addEventListener('input', updatePreview);
document.getElementById('title').addEventListener('input', updatePreview);

// Ù‚Ø§Ù„Ø¨â€ŒØ¨Ù†Ø¯ÛŒ Ù‚ÛŒÙ…Øª
function formatPrice(input) {
    const value = input.value;
    if (value) {
        const formatted = new Intl.NumberFormat('fa-IR').format(value);
        const preview = document.getElementById('pricePreview');
        preview.textContent = `${formatted} ØªÙˆÙ…Ø§Ù†`;
    } else {
        document.getElementById('pricePreview').textContent = '';
    }
}

// Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ ÙØ±Ù…
function updateFormFields() {
    const saleType = document.getElementById('typeSale').value;
    const cartonFields = document.querySelector('.carton-setting');
    const limitedFields = document.querySelector('.limited-setting');

    // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§
    if (cartonFields) cartonFields.classList.add('d-none');
    if (limitedFields) limitedFields.classList.add('d-none');

    // Ø­Ø°Ù required Ø§Ø² Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§
    const memberCarton = document.getElementById('memberCarton');
    const limitedSale = document.getElementById('limitedSale');

    if (memberCarton) memberCarton.required = false;
    if (limitedSale) limitedSale.required = false;

    // Ù†Ù…Ø§ÛŒØ´ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡
    if (saleType === '2') { // Ú©Ø§Ø±ØªÙ† ÙØ±ÙˆØ´ÛŒ
        if (cartonFields) {
            cartonFields.classList.remove('d-none');
            if (memberCarton) memberCarton.required = true;
        }
    } else if (saleType === '3') { // ØªÚ© ÙØ±ÙˆØ´ÛŒ Ø¨Ø§ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª
        if (limitedFields) {
            limitedFields.classList.remove('d-none');
            if (limitedSale) limitedSale.required = true;
        }
    }

    updateFinalPrice();
}

// Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‚ÛŒÙ…Øª Ù†Ù‡Ø§ÛŒÛŒ
function updateFinalPrice() {
    const price = document.getElementById('price').value;
    const finalPriceInput = document.getElementById('finalPrice');

    if (price && !isNaN(price)) {
        finalPriceInput.value = price;
    } else {
        finalPriceInput.value = '';
    }
}

// Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´
function updatePreview() {
    const saleType = document.getElementById('typeSale').value;
    const price = document.getElementById('price').value;
    const title = document.getElementById('title').value;
    const memberCarton = document.getElementById('memberCarton')?.value;
    const limitedSale = document.getElementById('limitedSale')?.value;

    const previewContent = document.getElementById('previewContent');
    const previewCard = document.getElementById('pricePreviewCard');
    const previewPrice = document.getElementById('previewPrice');
    const previewType = document.getElementById('previewType');
    const previewDetails = document.getElementById('previewDetails');

    if (!saleType || !price) {
        previewContent.classList.remove('d-none');
        previewCard.classList.add('d-none');
        return;
    }

    // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´
    previewContent.classList.add('d-none');
    previewCard.classList.remove('d-none');

    // Ù‚Ø§Ù„Ø¨â€ŒØ¨Ù†Ø¯ÛŒ Ù‚ÛŒÙ…Øª
    const formattedPrice = new Intl.NumberFormat('fa-IR').format(price);
    previewPrice.textContent = formattedPrice;

    // ØªØ¹ÛŒÛŒÙ† Ù†ÙˆØ¹ ÙØ±ÙˆØ´
    let typeText = '';
    let detailsHtml = '';

    switch(saleType) {
        case '1':
            typeText = 'ØªÚ© ÙØ±ÙˆØ´ÛŒ';
            detailsHtml = `<div><i class="fas fa-check text-success"></i> Ù‚ÛŒÙ…Øª Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¹Ø¯Ø¯</div>`;
            if (title) detailsHtml += `<div class="mt-1"><strong>Ø¹Ù†ÙˆØ§Ù†:</strong> ${title}</div>`;
            break;

        case '2':
            typeText = 'Ú©Ø§Ø±ØªÙ† ÙØ±ÙˆØ´ÛŒ';
            if (memberCarton) {
                detailsHtml = `
                    <div><i class="fas fa-check text-success"></i> Ù‚ÛŒÙ…Øª Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ú©Ø§Ø±ØªÙ†</div>
                    <div class="mt-1"><strong>ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø± Ú©Ø§Ø±ØªÙ†:</strong> ${memberCarton} Ø¹Ø¯Ø¯</div>
                `;
                if (title) detailsHtml += `<div class="mt-1"><strong>Ø¹Ù†ÙˆØ§Ù†:</strong> ${title}</div>`;
            }
            break;

        case '3':
            typeText = 'ØªÚ© ÙØ±ÙˆØ´ÛŒ Ø¨Ø§ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª';
            detailsHtml = `<div><i class="fas fa-check text-success"></i> Ù‚ÛŒÙ…Øª Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¹Ø¯Ø¯</div>`;
            if (limitedSale) {
                detailsHtml += `<div class="mt-1"><strong>Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø®Ø±ÛŒØ¯:</strong> ${limitedSale} Ø¹Ø¯Ø¯</div>`;
            }
            if (title) detailsHtml += `<div class="mt-1"><strong>Ø¹Ù†ÙˆØ§Ù†:</strong> ${title}</div>`;
            break;
    }

    previewType.textContent = typeText;
    previewDetails.innerHTML = detailsHtml;
}

// Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙØ±Ù…
document.getElementById('saleTypeForm').addEventListener('submit', function(e) {
    const saleType = document.getElementById('typeSale').value;
    const price = document.getElementById('price').value;

    if (!saleType) {
        e.preventDefault();
        alert('Ù„Ø·ÙØ§ Ù†ÙˆØ¹ ÙØ±ÙˆØ´ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
        document.getElementById('typeSale').focus();
        return;
    }

    if (!price || price <= 0) {
        e.preventDefault();
        alert('Ù„Ø·ÙØ§ Ù‚ÛŒÙ…Øª Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
        document.getElementById('price').focus();
        return;
    }

    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ
    if (saleType === '2') {
        const memberCarton = document.getElementById('memberCarton').value;
        if (!memberCarton || memberCarton <= 0) {
            e.preventDefault();
            alert('Ù„Ø·ÙØ§ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø± Ú©Ø§Ø±ØªÙ† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
            document.getElementById('memberCarton').focus();
            return;
        }
    }

    if (saleType === '3') {
        const limitedSale = document.getElementById('limitedSale').value;
        if (!limitedSale || limitedSale <= 0) {
            e.preventDefault();
            alert('Ù„Ø·ÙØ§ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø®Ø±ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
            document.getElementById('limitedSale').focus();
            return;
        }
    }

    // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… ØªØ§ÛŒÛŒØ¯
    if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
        e.preventDefault();
    }
});

// Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
document.addEventListener('DOMContentLoaded', function() {
    updateFormFields();
    updatePreview();
});
</script>
{% endblock %}