<!-- templates/panelAdmin/products/comment/list.html -->
{% extends '../../base/base.html' %}

{% block title %}مدیریت نظرات{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'panelAdmin:admin_comment_list' %}">نظرات</a></li>
<li class="breadcrumb-item active">لیست نظرات</li>
{% endblock %}

{% block page_title %}مدیریت نظرات محصولات{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">لیست نظرات کاربران</h5>
                <div class="comment-stats">
                    <span class="badge bg-info">{{ page_obj.paginator.count }} نظر</span>
                </div>
            </div>
            <div class="card-body">
                <!-- آمار کلی -->
                <div class="row mb-4">
                    <div class="col-md-3 col-sm-6 mb-3">
                        <div class="stat-card primary p-3 rounded">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-1">کل نظرات</h6>
                                    <h3 class="mb-0">{{ page_obj.paginator.count }}</h3>
                                </div>
                                <i class="fas fa-comments fa-2x text-primary"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-3">
                        <div class="stat-card success p-3 rounded">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-1">نظرات فعال</h6>
                                    <h3 class="mb-0">{{ active_comments_count|default:"0" }}</h3>
                                </div>
                                <i class="fas fa-check-circle fa-2x text-success"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-3">
                        <div class="stat-card warning p-3 rounded">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-1">پیشنهاد شده</h6>
                                    <h3 class="mb-0">{{ recommend_count|default:"0" }}</h3>
                                </div>
                                <i class="fas fa-thumbs-up fa-2x text-warning"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-3">
                        <div class="stat-card danger p-3 rounded">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-1">پیشنهاد نشده</h6>
                                    <h3 class="mb-0">{{ not_recommend_count|default:"0" }}</h3>
                                </div>
                                <i class="fas fa-thumbs-down fa-2x text-danger"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- فیلترها -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <form method="get" id="filterForm" class="row g-3">
                            <!-- جستجو -->
                            <div class="col-md-3">
                                <div class="input-group">
                                    <input type="text"
                                           class="form-control"
                                           name="search"
                                           placeholder="جستجو در نظرات..."
                                           value="{{ request.GET.search|default:'' }}">
                                    <button class="btn btn-outline-secondary" type="submit">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- فیلتر محصول -->
                            <div class="col-md-2">
                                <select class="form-select" name="product" onchange="this.form.submit()">
                                    <option value="">همه محصولات</option>
                                    {% for product in products %}
                                    <option value="{{ product.id }}"
                                            {% if selected_product == product.id|stringformat:"s" %}selected{% endif %}>
                                        {{ product.title|truncatechars:20 }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>

                            <!-- فیلتر وضعیت -->
                            <div class="col-md-2">
                                <select class="form-select" name="status" onchange="this.form.submit()">
                                    <option value="">همه وضعیت‌ها</option>
                                    <option value="active" {% if selected_status == 'active' %}selected{% endif %}>فعال</option>
                                    <option value="inactive" {% if selected_status == 'inactive' %}selected{% endif %}>غیرفعال</option>
                                </select>
                            </div>

                            <!-- فیلتر نوع -->
                            <div class="col-md-2">
                                <select class="form-select" name="type" onchange="this.form.submit()">
                                    <option value="">همه انواع</option>
                                    <option value="recommend" {% if selected_type == 'recommend' %}selected{% endif %}>پیشنهاد می‌کنم</option>
                                    <option value="not_recommend" {% if selected_type == 'not_recommend' %}selected{% endif %}>پیشنهاد نمی‌کنم</option>
                                </select>
                            </div>

                            <!-- دکمه پاک کردن فیلترها -->
                            <div class="col-md-3">
                                <div class="d-flex gap-2">
                                    <a href="{% url 'panelAdmin:admin_comment_list' %}" class="btn btn-outline-secondary w-100">
                                        <i class="fas fa-times"></i> پاک کردن
                                    </a>
                                    <button type="button" class="btn btn-outline-info" id="bulkActionsBtn" data-bs-toggle="modal" data-bs-target="#bulkActionsModal">
                                        <i class="fas fa-tasks"></i> عملیات گروهی
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- نمایش فیلترهای فعال -->
                {% if selected_product or selected_status or selected_type or request.GET.search %}
                <div class="alert alert-info mb-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <i class="fas fa-filter"></i>
                            <strong>فیلترهای فعال:</strong>
                            {% if request.GET.search %}
                            <span class="badge bg-primary me-2">جستجو: {{ request.GET.search }}</span>
                            {% endif %}
                            {% if selected_product %}
                                {% for product in products %}
                                    {% if product.id|stringformat:"s" == selected_product %}
                                    <span class="badge bg-info me-2">محصول: {{ product.title|truncatechars:15 }}</span>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                            {% if selected_status %}
                            <span class="badge bg-{% if selected_status == 'active' %}success{% else %}warning{% endif %} me-2">
                                وضعیت: {% if selected_status == 'active' %}فعال{% else %}غیرفعال{% endif %}
                            </span>
                            {% endif %}
                            {% if selected_type %}
                            <span class="badge bg-{% if selected_type == 'recommend' %}success{% else %}danger{% endif %} me-2">
                                نوع: {% if selected_type == 'recommend' %}پیشنهاد می‌کنم{% else %}پیشنهاد نمی‌کنم{% endif %}
                            </span>
                            {% endif %}
                        </div>
                        <span>تعداد: {{ page_obj.paginator.count }} نظر</span>
                    </div>
                </div>
                {% endif %}

                <!-- جدول نظرات -->
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th width="50">
                                    <input type="checkbox" id="selectAll" class="form-check-input">
                                </th>
                                <th>مشخصات کاربر</th>
                                <th>محصول</th>
                                <th>متن نظر</th>
                                <th>وضعیت</th>
                                <th>نوع نظر</th>
                                <th>تاریخ</th>
                                <th width="150">عملیات</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for comment in page_obj %}
                            <tr class="{% if not comment.isActive %}table-secondary{% endif %}">
                                <td>
                                    <input type="checkbox" name="comment_ids" value="{{ comment.id }}"
                                           class="form-check-input comment-checkbox">
                                </td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar me-3">
                                            <img src="https://ui-avatars.com/api/?name={{ comment.user.mobileNumber }}&background=4361ee&color=fff&size=40"
                                                 class="rounded-circle" width="40" height="40" alt="{{ comment.user.mobileNumber }}">
                                        </div>
                                        <div>
                                            <strong class="text-primary d-block">{{ comment.user.mobileNumber }}</strong>
                                            <small class="text-muted">
                                                {% if comment.user.name or comment.user.family %}
                                                    {{ comment.user.name|default:'' }} {{ comment.user.family|default:'' }}
                                                {% else %}
                                                    کاربر
                                                {% endif %}
                                            </small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <a href="{% url 'panelAdmin:admin_product_detail' comment.product.id %}"
                                       class="text-decoration-none">
                                        <div class="product-info">
                                            <strong class="text-dark d-block">{{ comment.product.title|truncatechars:20 }}</strong>
                                            <small class="text-muted">کد: {{ comment.product.id|slice:":8" }}</small>
                                        </div>
                                    </a>
                                </td>
                                <td>
                                    <div class="comment-text">
                                        <p class="mb-1">{{ comment.text|truncatechars:100 }}</p>
                                        {% if comment.text|length > 100 %}
                                        <a href="#" class="text-primary read-more"
                                           data-comment-id="{{ comment.id }}"
                                           data-bs-toggle="modal"
                                           data-bs-target="#commentModal"
                                           data-comment-text="{{ comment.text }}"
                                           data-user-name="{{ comment.user.name|default:'' }} {{ comment.user.family|default:'' }}"
                                           data-user-mobile="{{ comment.user.mobileNumber }}"
                                           data-product-title="{{ comment.product.title }}"
                                           data-product-id="{{ comment.product.id }}"
                                           data-comment-type="{% if comment.typeComment == 'recommend' %}پیشنهاد می‌کنم{% else %}پیشنهاد نمی‌کنم{% endif %}"
                                           data-comment-date="{{ comment.createdAt|date:'Y/m/d H:i' }}">
                                            مشاهده کامل
                                        </a>
                                        {% endif %}
                                    </div>
                                </td>
                                <td>
                                    <form method="post"
                                          action="{% url 'panelAdmin:admin_comment_toggle' comment.id %}"
                                          class="toggle-form">
                                        {% csrf_token %}
                                        <div class="form-check form-switch">
                                            <input class="form-check-input status-toggle"
                                                   type="checkbox"
                                                   id="status_{{ comment.id }}"
                                                   {% if comment.isActive %}checked{% endif %}
                                                   onchange="toggleCommentStatus(this, {{ comment.id }})">
                                            <label class="form-check-label" for="status_{{ comment.id }}">
                                                {% if comment.isActive %}
                                                <span class="badge bg-success">فعال</span>
                                                {% else %}
                                                <span class="badge bg-danger">غیرفعال</span>
                                                {% endif %}
                                            </label>
                                        </div>
                                    </form>
                                </td>
                                <td>
                                    {% if comment.typeComment == 'recommend' %}
                                    <span class="badge bg-success">
                                        <i class="fas fa-thumbs-up"></i> پیشنهاد می‌کنم
                                    </span>
                                    {% else %}
                                    <span class="badge bg-danger">
                                        <i class="fas fa-thumbs-down"></i> پیشنهاد نمی‌کنم
                                    </span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="text-muted d-block">
                                        {{ comment.createdAt|date:"Y/m/d" }}
                                    </span>
                                    <small class="d-block text-muted">{{ comment.createdAt|time }}</small>
                                    <small class="d-block text-muted">
                                        {{ comment.createdAt|timesince }} قبل
                                    </small>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <!-- دیدن کامل نظر -->
                                        <button type="button"
                                                class="btn btn-sm btn-info mb-1"
                                                data-bs-toggle="modal"
                                                data-bs-target="#commentModal"
                                                data-comment-id="{{ comment.id }}"
                                                data-comment-text="{{ comment.text }}"
                                                data-user-name="{{ comment.user.name|default:'' }} {{ comment.user.family|default:'' }}"
                                                data-user-mobile="{{ comment.user.mobileNumber }}"
                                                data-product-title="{{ comment.product.title }}"
                                                data-product-id="{{ comment.product.id }}"
                                                data-comment-type="{% if comment.typeComment == 'recommend' %}پیشنهاد می‌کنم{% else %}پیشنهاد نمی‌کنم{% endif %}"
                                                data-comment-date="{{ comment.createdAt|date:'Y/m/d H:i' }}">
                                            <i class="fas fa-eye"></i>
                                        </button>

                                        <!-- حذف نظر -->
                                        <form method="post"
                                              action="{% url 'panelAdmin:admin_comment_delete' comment.id %}"
                                              class="d-inline"
                                              onsubmit="return confirm('آیا از حذف این نظر اطمینان دارید؟')">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-sm btn-danger mb-1">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="8" class="text-center py-5">
                                    <div class="text-muted">
                                        <i class="fas fa-comments fa-3x mb-3"></i>
                                        <h5>هیچ نظری یافت نشد</h5>
                                        <p class="mb-3">با تغییر فیلترها دوباره تلاش کنید</p>
                                        <a href="{% url 'panelAdmin:admin_comment_list' %}" class="btn btn-primary">
                                            <i class="fas fa-times"></i> پاک کردن فیلترها
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- صفحه‌بندی -->
                {% if page_obj.has_other_pages %}
                <nav aria-label="Page navigation" class="mt-4">
                    <ul class="pagination justify-content-center">
                        {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                                <i class="fas fa-chevron-right"></i> قبلی
                            </a>
                        </li>
                        {% endif %}

                        {% for num in page_obj.paginator.page_range %}
                            {% if page_obj.number == num %}
                            <li class="page-item active">
                                <span class="page-link">{{ num }}</span>
                            </li>
                            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ num }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                                    {{ num }}
                                </a>
                            </li>
                            {% endif %}
                        {% endfor %}

                        {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                                بعدی <i class="fas fa-chevron-left"></i>
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- مودال مشاهده کامل نظر -->
<div class="modal fade" id="commentModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">مشاهده کامل نظر</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <!-- اطلاعات کاربر -->
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-user"></i> اطلاعات کاربر</h6>
                            </div>
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-3">
                                    <div class="avatar me-3">
                                        <img src="" class="rounded-circle" width="60" height="60" id="modalUserAvatar">
                                    </div>
                                    <div>
                                        <h6 id="modalUserName">نام کاربر</h6>
                                        <p class="text-muted mb-0" id="modalUserMobile">شماره موبایل</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- اطلاعات محصول -->
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-box"></i> اطلاعات محصول</h6>
                            </div>
                            <div class="card-body">
                                <h6 id="modalProductTitle">عنوان محصول</h6>
                                <p class="text-muted mb-2" id="modalProductId">شناسه: -</p>
                                <a href="#" id="modalProductLink" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-external-link-alt"></i> مشاهده محصول
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- متن کامل نظر -->
                <div class="card mb-3">
                    <div class="card-header">
                        <h6 class="mb-0"><i class="fas fa-comment"></i> متن نظر</h6>
                    </div>
                    <div class="card-body">
                        <div class="comment-full-text" id="modalCommentText">
                            متن نظر در اینجا نمایش داده می‌شود...
                        </div>
                        <div class="mt-3">
                            <span class="badge bg-info" id="modalCommentType">نوع نظر</span>
                            <span class="badge bg-secondary ms-2" id="modalCommentDate">تاریخ</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بستن</button>
            </div>
        </div>
    </div>
</div>

<!-- مودال عملیات گروهی -->
<div class="modal fade" id="bulkActionsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">عملیات گروهی</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="{% url 'panelAdmin:admin_bulk_comment_action' %}" id="bulkActionsForm">
                    {% csrf_token %}
                    <input type="hidden" name="comment_ids" id="bulkCommentIds">

                    <div class="mb-3">
                        <label class="form-label">انتخاب عملیات:</label>
                        <select class="form-select" name="bulk_action" id="bulkActionSelect">
                            <option value="">-- انتخاب کنید --</option>
                            <option value="activate">فعال کردن</option>
                            <option value="deactivate">غیرفعال کردن</option>
                            <option value="delete">حذف</option>
                        </select>
                    </div>

                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        این عملیات بر روی <span id="selectedCount">0</span> نظر انتخاب شده اعمال می‌شود.
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">لغو</button>
                <button type="button" class="btn btn-primary" onclick="submitBulkAction()">اعمال عملیات</button>
            </div>
        </div>
    </div>
</div>

<style>
.stat-card {
    background: white;
    border-left: 4px solid;
    transition: transform 0.3s;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}
.stat-card.primary { border-color: #4361ee; }
.stat-card.success { border-color: #4cc9f0; }
.stat-card.warning { border-color: #f8961e; }
.stat-card.danger { border-color: #f72585; }

.avatar img {
    width: 40px;
    height: 40px;
    object-fit: cover;
}

.comment-text {
    max-width: 250px;
}

.comment-full-text {
    line-height: 1.8;
    font-size: 1.1em;
}

.action-buttons .btn {
    margin-left: 3px;
    margin-right: 3px;
    width: 36px;
    height: 36px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.form-switch .form-check-input {
    width: 3em;
    height: 1.5em;
    cursor: pointer;
}

.form-switch .form-check-input:checked {
    background-color: #4cc9f0;
    border-color: #4cc9f0;
}

.table-secondary {
    background-color: rgba(0,0,0,0.02);
}

.read-more {
    font-size: 0.85em;
    text-decoration: none;
}

.read-more:hover {
    text-decoration: underline;
}

.product-info {
    max-width: 200px;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // مدیریت انتخاب همه
    const selectAll = document.getElementById('selectAll');
    const checkboxes = document.querySelectorAll('.comment-checkbox');

    selectAll.addEventListener('change', function() {
        checkboxes.forEach(checkbox => {
            checkbox.checked = this.checked;
        });
        updateSelectedCount();
    });

    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            updateSelectedCount();
        });
    });

    // مودال مشاهده کامل نظر
    const commentModal = document.getElementById('commentModal');
    if (commentModal) {
        commentModal.addEventListener('show.bs.modal', function(event) {
            const button = event.relatedTarget;
            const commentText = button.getAttribute('data-comment-text');
            const userName = button.getAttribute('data-user-name') || 'کاربر';
            const userMobile = button.getAttribute('data-user-mobile');
            const productTitle = button.getAttribute('data-product-title');
            const productId = button.getAttribute('data-product-id');
            const commentType = button.getAttribute('data-comment-type');
            const commentDate = button.getAttribute('data-comment-date');

            // به‌روزرسانی آواتار
            const avatar = document.getElementById('modalUserAvatar');
            avatar.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(userName)}&background=4361ee&color=fff&size=60`;

            // به‌روزرسانی محتوای مودال
            document.getElementById('modalUserName').textContent = userName || 'کاربر';
            document.getElementById('modalUserMobile').textContent = userMobile;
            document.getElementById('modalProductTitle').textContent = productTitle;
            document.getElementById('modalProductId').textContent = 'شناسه: ' + productId;
            document.getElementById('modalCommentText').textContent = commentText;
            document.getElementById('modalCommentType').textContent = commentType;
            document.getElementById('modalCommentDate').textContent = commentDate;

            // لینک محصول
            const productLink = document.getElementById('modalProductLink');
            productLink.href = `/panelAdmin/products/${productId}/`;
        });
    }

    // مودال عملیات گروهی
    const bulkActionsModal = document.getElementById('bulkActionsModal');
    if (bulkActionsModal) {
        bulkActionsModal.addEventListener('show.bs.modal', function() {
            updateSelectedCount();
        });
    }

    // تابع به‌روزرسانی تعداد انتخاب شده‌ها
    function updateSelectedCount() {
        const selected = document.querySelectorAll('.comment-checkbox:checked');
        const count = selected.length;
        document.getElementById('selectedCount').textContent = count;

        // جمع‌آوری شناسه‌های انتخاب شده
        const selectedIds = Array.from(selected).map(cb => cb.value);
        document.getElementById('bulkCommentIds').value = selectedIds.join(',');
    }

    // تابع تغییر وضعیت کامنت
    window.toggleCommentStatus = function(checkbox, commentId) {
        const action = checkbox.checked ? 'فعال' : 'غیرفعال';
        const confirmed = confirm(`آیا از ${action} کردن این نظر اطمینان دارید؟`);

        if (!confirmed) {
            checkbox.checked = !checkbox.checked;
            return;
        }

        // ارسال درخواست AJAX
        const form = checkbox.closest('.toggle-form');
        const csrfToken = form.querySelector('input[name="csrfmiddlewaretoken"]').value;

        fetch(form.action, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': csrfToken
            },
            body: `csrfmiddlewaretoken=${csrfToken}`
        })
        .then(response => {
            if (response.ok) {
                // به‌روزرسانی UI
                const label = checkbox.nextElementSibling;
                if (checkbox.checked) {
                    label.innerHTML = '<span class="badge bg-success">فعال</span>';
                } else {
                    label.innerHTML = '<span class="badge bg-danger">غیرفعال</span>';
                }
            } else {
                checkbox.checked = !checkbox.checked;
                alert('خطا در تغییر وضعیت نظر');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            checkbox.checked = !checkbox.checked;
            alert('خطا در ارتباط با سرور');
        });
    };

    // ارسال عملیات گروهی
    window.submitBulkAction = function() {
        const action = document.getElementById('bulkActionSelect').value;
        const commentIds = document.getElementById('bulkCommentIds').value;

        if (!action) {
            alert('لطفا یک عملیات انتخاب کنید.');
            return;
        }

        if (!commentIds) {
            alert('هیچ نظری انتخاب نشده است.');
            return;
        }

        let message = '';
        switch(action) {
            case 'activate':
                message = `آیا از فعال کردن ${commentIds.split(',').length} نظر انتخاب شده اطمینان دارید؟`;
                break;
            case 'deactivate':
                message = `آیا از غیرفعال کردن ${commentIds.split(',').length} نظر انتخاب شده اطمینان دارید؟`;
                break;
            case 'delete':
                message = `آیا از حذف ${commentIds.split(',').length} نظر انتخاب شده اطمینان دارید؟ این عمل غیرقابل بازگشت است.`;
                break;
        }

        if (confirm(message)) {
            document.getElementById('bulkActionsForm').submit();
        }
    };
});
</script>
{% endblock %}