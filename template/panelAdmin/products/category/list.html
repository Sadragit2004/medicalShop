<!-- templates/panelAdmin/products/category/list.html -->
{% extends '../../base/base.html' %}

{% block title %}Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'panelAdmin:admin_dashboard' %}">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a></li>
<li class="breadcrumb-item active">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</li>
{% endblock %}

{% block page_title %}Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">Ù„ÛŒØ³Øª Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</h5>
                <a href="{% url 'panelAdmin:admin_category_create' %}" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯
                </a>
            </div>
            <div class="card-body">
                <!-- Ø¢Ù…Ø§Ø± -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="stat-card primary p-3 rounded">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-1">Ú©Ù„ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</h6>
                                    <h3 class="mb-0">{{ categories.count }}</h3>
                                </div>
                                <i class="fas fa-folder fa-2x text-primary"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card success p-3 rounded">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-1">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„</h6>
                                    <h3 class="mb-0">{{ active_categories }}</h3>
                                </div>
                                <i class="fas fa-check-circle fa-2x text-success"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card warning p-3 rounded">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-1">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ</h6>
                                    <h3 class="mb-0">{{ main_categories }}</h3>
                                </div>
                                <i class="fas fa-sitemap fa-2x text-warning"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card danger p-3 rounded">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-1">Ø²ÛŒØ±Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§</h6>
                                    <h3 class="mb-0">{{ sub_categories }}</h3>
                                </div>
                                <i class="fas fa-folder-tree fa-2x text-danger"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÙÛŒÙ„ØªØ± Ùˆ Ø¬Ø³ØªØ¬Ùˆ -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="search-box">
                            <input type="text" class="form-control" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ..." id="searchInput">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="statusFilter">
                            <option value="">Ù‡Ù…Ù‡ ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§</option>
                            <option value="active">ÙØ¹Ø§Ù„</option>
                            <option value="inactive">ØºÛŒØ±ÙØ¹Ø§Ù„</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="parentFilter">
                            <option value="">Ù‡Ù…Ù‡ ÙˆØ§Ù„Ø¯Ù‡Ø§</option>
                            <option value="main">ÙÙ‚Ø· Ø§ØµÙ„ÛŒâ€ŒÙ‡Ø§</option>
                            <option value="sub">ÙÙ‚Ø· Ø²ÛŒØ±Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§</option>
                        </select>
                    </div>
                </div>

                <!-- Ø¬Ø¯ÙˆÙ„ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ -->
                <div class="table-responsive">
                    <table class="table table-hover" id="categoryTable">
                        <thead class="table-light">
                            <tr>
                                <th width="50">#</th>
                                <th>Ø¹Ù†ÙˆØ§Ù†</th>
                                <th>Ø§Ø³Ù„Ø§Ú¯</th>
                                <th>ÙˆØ§Ù„Ø¯</th>
                                <th>ØªØµÙˆÛŒØ±</th>
                                <th>ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                <th>ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯</th>
                                <th width="120">Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for category in categories %}
                            <tr data-status="{% if category.isActive %}active{% else %}inactive{% endif %}"
                                data-parent="{% if category.parent %}sub{% else %}main{% endif %}">
                                <td>{{ forloop.counter }}</td>
                                <td>
                                    <strong class="category-title">{{ category.title }}</strong>
                                    {% if category.children.all %}
                                    <span class="badge bg-info ms-2" title="ØªØ¹Ø¯Ø§Ø¯ Ø²ÛŒØ±Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§">{{ category.children.count }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <code class="category-slug">{{ category.slug }}</code>
                                </td>
                                <td>
                                    {% if category.parent %}
                                        <span class="badge bg-secondary">{{ category.parent.title }}</span>
                                    {% else %}
                                        <span class="text-muted">Ø§ØµÙ„ÛŒ</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if category.image %}
                                    <img src="{{ category.image.url }}" alt="{{ category.title }}"
                                         class="img-thumbnail" style="width: 60px; height: 60px; object-fit: cover;"
                                         data-bs-toggle="tooltip" title="{{ category.title }}">
                                    {% else %}
                                    <div class="no-image">
                                        <i class="fas fa-image text-muted"></i>
                                    </div>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge bg-primary">{{ category.products.count }}</span>
                                </td>
                                <td>
                                    {% if category.isActive %}
                                    <span class="badge bg-success">ÙØ¹Ø§Ù„</span>
                                    {% else %}
                                    <span class="badge bg-danger">ØºÛŒØ±ÙØ¹Ø§Ù„</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {{ category.createdAt|date:"Y/m/d" }}
                                    <small class="d-block text-muted">{{ category.createdAt|time }}</small>
                                </td>
                                <td>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <a href="#" class="btn btn-info" data-bs-toggle="tooltip" title="Ù…Ø´Ø§Ù‡Ø¯Ù‡">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a href="{% url 'panelAdmin:admin_category_update' category.id %}"
                                           class="btn btn-warning" data-bs-toggle="tooltip" title="ÙˆÛŒØ±Ø§ÛŒØ´">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <a href="{% url 'panelAdmin:admin_category_delete' category.id %}"
                                           class="btn btn-danger" data-bs-toggle="tooltip" title="Ø­Ø°Ù"
                                           onclick="return confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')">
                                            <i class="fas fa-trash"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="9" class="text-center py-5">
                                    <div class="text-muted">
                                        <i class="fas fa-folder fa-3x mb-3"></i>
                                        <h5>Ù‡ÛŒÚ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</h5>
                                        <p class="mb-3">Ø§ÙˆÙ„ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯</p>
                                        <a href="{% url 'panelAdmin:admin_category_create' %}" class="btn btn-primary">
                                            Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- Ù†Ù…Ø§ÛŒØ´ Ø¯Ø±Ø®ØªÛŒ -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Ù†Ù…Ø§ÛŒØ´ Ø¯Ø±Ø®ØªÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</h5>
                    </div>
                    <div class="card-body">
                        <div class="category-tree">
                            <ul class="tree">
                                {% for category in categories %}
                                    {% if not category.parent %}
                                       
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.stat-card {
    background: white;
    border-left: 4px solid;
    transition: transform 0.3s;
}
.stat-card:hover {
    transform: translateY(-5px);
}
.stat-card.primary { border-color: #4361ee; }
.stat-card.success { border-color: #4cc9f0; }
.stat-card.warning { border-color: #f8961e; }
.stat-card.danger { border-color: #f72585; }

.no-image {
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f8f9fa;
    border-radius: 6px;
    font-size: 24px;
}

.category-tree {
    max-height: 400px;
    overflow-y: auto;
    padding: 10px;
}

.tree {
    list-style: none;
    padding-left: 0;
}

.tree ul {
    list-style: none;
    padding-left: 25px;
    margin-top: 10px;
    border-left: 2px solid #dee2e6;
}

.tree li {
    padding: 8px 0;
    position: relative;
}

.tree li:before {
    content: "ğŸ“";
    position: absolute;
    right: -25px;
    top: 8px;
}

.tree .tree-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    background: #f8f9fa;
    border-radius: 6px;
    margin-bottom: 5px;
}

.tree .tree-item:hover {
    background: #e9ecef;
}
</style>

<script>
// ÙÛŒÙ„ØªØ± Ø¬Ø¯ÙˆÙ„
function filterTable() {
    const searchValue = document.getElementById('searchInput').value.toLowerCase();
    const statusFilter = document.getElementById('statusFilter').value;
    const parentFilter = document.getElementById('parentFilter').value;

    const rows = document.querySelectorAll('#categoryTable tbody tr');

    rows.forEach(row => {
        const title = row.querySelector('.category-title').textContent.toLowerCase();
        const slug = row.querySelector('.category-slug').textContent.toLowerCase();
        const status = row.getAttribute('data-status');
        const parent = row.getAttribute('data-parent');

        let show = true;

        // Ø¬Ø³ØªØ¬Ùˆ
        if (searchValue && !title.includes(searchValue) && !slug.includes(searchValue)) {
            show = false;
        }

        // ÙÛŒÙ„ØªØ± ÙˆØ¶Ø¹ÛŒØª
        if (statusFilter && status !== statusFilter) {
            show = false;
        }

        // ÙÛŒÙ„ØªØ± ÙˆØ§Ù„Ø¯
        if (parentFilter && parent !== parentFilter) {
            show = false;
        }

        row.style.display = show ? '' : 'none';
    });
}

document.getElementById('searchInput').addEventListener('input', filterTable);
document.getElementById('statusFilter').addEventListener('change', filterTable);
document.getElementById('parentFilter').addEventListener('change', filterTable);

// Ø¨Ø§Ø² Ú©Ø±Ø¯Ù†/Ø¨Ø³ØªÙ† Ø²ÛŒØ±Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ Ø¯Ø± Ù†Ù…Ø§ÛŒØ´ Ø¯Ø±Ø®ØªÛŒ
document.querySelectorAll('.toggle-children').forEach(btn => {
    btn.addEventListener('click', function() {
        const children = this.closest('li').querySelector('ul');
        if (children) {
            children.style.display = children.style.display === 'none' ? 'block' : 'none';
            this.innerHTML = children.style.display === 'none' ?
                '<i class="fas fa-chevron-left"></i>' :
                '<i class="fas fa-chevron-down"></i>';
        }
    });
});
</script>
{% endblock %}