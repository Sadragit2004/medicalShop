{% extends "account_template.html" %}

{% block content %}
  <!-- ALL ICONS -->
  <svg class="hidden">
    <symbol id="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
      <path fill-rule="evenodd"
        d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z"
        clip-rule="evenodd" />
    </symbol>
    <symbol id="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
      <path
        d="M12 2.25a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75ZM7.5 12a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM18.894 6.166a.75.75 0 0 0-1.06-1.06l-1.591 1.59a.75.75 0 1 0 1.06 1.061l1.591-1.59ZM21.75 12a.75.75 0 0 1-.75.75h-2.25a.75.75 0 0 1 0-1.5H21a.75.75 0 0 1 .75.75ZM17.834 18.894a.75.75 0 0 0 1.06-1.06l-1.59-1.591a.75.75 0 1 0-1.061 1.06l1.59 1.591ZM12 18a.75.75 0 0 1 .75.75V21a.75.75 0 0 1-1.5 0v-2.25A.75.75 0 0 1 12 18ZM7.758 17.303a.75.75 0 0 0-1.061-1.06l-1.591 1.59a.75.75 0 0 0 1.06 1.061l1.591-1.59ZM6 12a.75.75 0 0 1-.75.75H3a.75.75 0 0 1 0-1.5h2.25A.75.75 0 0 1 6 12ZM6.697 7.757a.75.75 0 0 0 1.06-1.06l-1.59-1.591a.75.75 0 0 0-1.061 1.06l1.59 1.591Z" />
    </symbol>
  </svg>

  <section class="relative flex items-center justify-center min-h-screen w-full">
    <!-- background -->
    <div class="pointer-events-none absolute inset-0 flex w-screen items-center justify-center overflow-hidden
  [mask-image:radial-gradient(circle_at_center,rgba(255,255,255,1)_0%,rgba(255,255,255,0)_85%)]">

      <svg
        class="absolute left-0 top-0 h-full w-full stroke-black/10 stroke-[2]
    [mask-image:radial-gradient(circle_at_center,rgba(255,255,255,1)_20%,rgba(255,255,255,0)_95%)] dark:stroke-white/10">
        <rect width="100%" height="100%" stroke-width="0" fill="url(#grid-pattern)"></rect>
        <defs>
          <pattern id="grid-pattern" viewBox="0 0 64 64" width="60" height="60" patternUnits="userSpaceOnUse">
            <path d="M64 0H0V64" fill="none"></path>
          </pattern>
        </defs>
      </svg>
    </div>

    <div class="relative w-[27rem] mx-5 flex flex-col justify-center py-12 px-4 md:px-8 bg-white dark:bg-gray-800 shadow-md rounded-xl">
      <div class="flex items-center justify-center">
        <button class="toggle-theme absolute left-2 top-2 flex-center p-1.5 rounded-full text-gray-300">
          <svg class="inline-block dark:hidden size-5">
            <use href="#moon" />
          </svg>
          <svg class="hidden dark:inline size-5">
            <use href="#sun" />
          </svg>
        </button>
        <a href="index.html" class="flex flex-col text-center">
          <span class="font-MorabbaMedium text-4xl flex items-center">
            <span class="text-blue-500">کارین</span> شاپ
          </span>
        </a>
      </div>
      <div class="mt-10 sm:mx-auto sm:w-full sm:max-w-sm">
        <p class="mb-2 text-gray-800 dark:text-gray-100 font-DanaMedium text-lg">ورود | ثبت‌نام </p>

        <!-- فرم Django با POST و CSRF token -->
        <form class="space-y-5" method="POST" id="loginForm">
          {% csrf_token %}

          <div>
            <label for="mobileNumber" class="block text-sm/6 font-medium text-gray-500 dark:text-gray-300">
              لطفا شماره موبایل خود را وارد کنید
            </label>
            <div class="mt-3">
              <input
                type="text"
                name="mobileNumber"
                id="mobileNumber"
                required
                maxlength="11"
                minlength="11"
                class="block w-full p-3 text-base outline dark:outline-none outline-1 -outline-offset-1 placeholder:text-gray-400 sm:text-sm/6 transition-all
                text-gray-800 dark:text-gray-100 dark:bg-gray-900 bg-slate-100 border border-transparent hover:border-slate-200 appearance-none rounded-md outline-none focus:bg-white focus:border-indigo-400 focus:ring-2 focus:ring-indigo-100 dark:focus:ring-blue-400 mobile-input"
                placeholder="09123456789"
                value="{{ form.mobileNumber.value|default:'' }}"
              >
            </div>

            <!-- پیام تأیید/خطا -->
            <div id="mobileMessage" class="mt-2 text-sm hidden">
              <p id="mobileMessageText"></p>
            </div>

            <!-- نمایش خطاهای Django -->
            {% if form.mobileNumber.errors %}
              <div class="mt-2">
                {% for error in form.mobileNumber.errors %}
                  <p class="text-sm text-red-500">{{ error }}</p>
                {% endfor %}
              </div>
            {% endif %}
          </div>

          <div>
            <button type="submit" class="submit-btn w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-4 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
              دریافت کد تأیید
            </button>
          </div>
        </form>

        <!-- نمایش پیام‌های Django -->
        {% if messages %}
          <div class="mt-4">
            {% for message in messages %}
              <div class="p-3 rounded-md {% if message.tags == 'error' %}bg-red-100 text-red-700{% else %}bg-green-100 text-green-700{% endif %}">
                {{ message }}
              </div>
            {% endfor %}
          </div>
        {% endif %}

        <p class="mt-8 text-center text-sm/6 text-gray-500 dark:text-gray-300">
          ورود شما به معنای پذیرش <span class="text-blue-400">قوانین سایت</span> است
        </p>
      </div>
    </div>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const mobileInput = document.getElementById('mobileNumber');
      const mobileMessage = document.getElementById('mobileMessage');
      const mobileMessageText = document.getElementById('mobileMessageText');
      const form = document.getElementById('loginForm');

      // استایل دکمه‌های اصلی
      const submitBtn = document.querySelector('.submit-btn');
      submitBtn.className = 'submit-btn w-full py-3 px-4 rounded-md font-semibold transition-colors cursor-pointer bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2';

      // تابع بررسی شماره موبایل ایرانی
      function validateIranianMobile(mobile) {
        // الگوی شماره موبایل ایرانی (با 09 شروع می‌شود)
        const iranianMobilePattern = /^09[0-9]{9}$/;
        return iranianMobilePattern.test(mobile);
      }

      // تابع نمایش پیام
      function showMessage(message, isSuccess) {
        mobileMessage.classList.remove('hidden');
        mobileMessageText.textContent = message;

        if (isSuccess) {
          mobileMessage.className = 'mt-2 text-sm p-2 rounded-md bg-green-100 text-green-700 border border-green-200';
          mobileInput.className = mobileInput.className.replace(/border-[a-z]+-\d+/g, '') + ' border-2 border-green-500';
        } else {
          mobileMessage.className = 'mt-2 text-sm p-2 rounded-md bg-red-100 text-red-700 border border-red-200';
          mobileInput.className = mobileInput.className.replace(/border-[a-z]+-\d+/g, '') + ' border-2 border-red-500';
        }
      }

      // تابع پنهان کردن پیام
      function hideMessage() {
        mobileMessage.classList.add('hidden');
        mobileInput.className = mobileInput.className.replace(/border-2 border-[a-z]+-\d+/g, '');
      }

      // رویداد تغییر مقدار input
      mobileInput.addEventListener('input', function() {
        const value = this.value;

        // اگر خالی است، پیام را پنهان کن
        if (value.length === 0) {
          hideMessage();
          return;
        }

        // بررسی شماره موبایل
        if (validateIranianMobile(value)) {
          showMessage('✓ شماره موبایل معتبر است', true);
        } else if (value.length === 11) {
          showMessage('شماره موبایل معتبر نیست. باید با 09 شروع شود و 11 رقم باشد.', false);
        }
      });

      // رویداد focus
      mobileInput.addEventListener('focus', function() {
        if (this.value.length === 0) {
          hideMessage();
        }
      });

      // رویداد submit فرم (اعتبارسنجی نهایی)
      form.addEventListener('submit', function(event) {
        const mobileValue = mobileInput.value.trim();

        if (!validateIranianMobile(mobileValue)) {
          event.preventDefault();
          showMessage('لطفاً یک شماره موبایل ایرانی معتبر وارد کنید (09xxxxxxxxx)', false);
          mobileInput.focus();
        }
      });

      // اگر شماره قبلاً وارد شده بود، بررسی کن
      if (mobileInput.value.length > 0) {
        if (validateIranianMobile(mobileInput.value)) {
          showMessage('✓ شماره موبایل معتبر است', true);
        } else if (mobileInput.value.length === 11) {
          showMessage('شماره موبایل معتبر نیست. باید با 09 شروع شود و 11 رقم باشد.', false);
        }
      }
    });

    // تابع تغییر تم تاریک/روشن
    function toggleDarkMode() {
      const html = document.documentElement;
      const moonIcon = document.querySelector('#moon-icon');
      const sunIcon = document.querySelector('#sun-icon');

      if (html.classList.contains('dark')) {
        html.classList.remove('dark');
        localStorage.theme = 'light';
        moonIcon.classList.remove('hidden');
        sunIcon.classList.add('hidden');
      } else {
        html.classList.add('dark');
        localStorage.theme = 'dark';
        moonIcon.classList.add('hidden');
        sunIcon.classList.remove('hidden');
      }
    }

    // متصل کردن دکمه تغییر تم
    document.addEventListener('DOMContentLoaded', function() {
      const toggleBtn = document.querySelector('.toggle-theme');
      if (toggleBtn) {
        toggleBtn.addEventListener('click', toggleDarkMode);
      }
    });
  </script>

{% endblock content %}